# Проектная работа: диплом

https://github.com/ADesBiysk/graduate_work

## О проекте
Наш проект – сервис полного цикла для «умной» отправки пуш-уведомлений для аналитиков и маркетологов windy.app

Сервис позволяет тестировать разные типы данных в рассылках маркетинговых и транзакционных пуш-уведомлений.

Windy.app – глобальное мобильное приложение с 18 млн установок. Показывает погоду занимающимся активными видами спорта (яхтсмены, кайтеры, серферы, рыбаки...)

Схема проекта, а также схема таблиц в БД: https://miro.com/app/board/uXjVPVD2kjE=/

## Сервисы проекта:
1. Async Admin API FastAPI:
- docker-compose up -d
- Swagger http://0.0.0.0:80/api/openapi
- Для локального запуска python run_admin_api.py

Что внутри:
- настройка цепочек фильтров для динамического формирования когорт пользователей, и сохранение для дальнейшего использования.
- настройка параметров рассылки уведомлений (тексты креативов, когорты пользователей, типа сплит-теста, время и продолжительность рассылки)
- запуск кампаний
- просмотр статистики real-time

Все данные хранятся в MySQL, статистика - в ClickHouse.
На данный момент реализована только часть endpoints (get, create для кампаний, когорт, пушей и get для получения статистики отправок для кампании)

2. Async ETL Push logs:
- получение статуса отправки уведомления из OpenSignal API и сохранение в ClickHouse.
- Для локального запуска python run_etl_logs.py


3. Worker
- получение списка рассылки из RabbitMQ
- предварительная проверка, что: 
a. пользователь принадлежит заявленной когорте (MySQL или ClickHouse)
b. валидность пуш-токена (мог уже поменяться) (MySQL или ClickHouse)
c. пользователь не отписался от рассылок (MySQL или ClickHouse)
- Для локального запуска python run_worker.py

4. Distributor 
- получение пачки подготовленных к рассылке уведомлений и отправить в очередь (ClickHouse)
- Multi-armed bandit and A_B: на основе статистики рассылки (ClickHouse) формирование размера рассылки по разным вариантам сообщений.
- отправка рассылок в RabbitMQ
- Для локального запуска python run_distributor.py

## Дальнейшее развитие проекта
- сделать все сервисы асинхронными для использования одних репозиториев и сервисов
- рефакторинг кода для уменьшения дублирования
# PushService
